{"version":3,"sources":["./src/app/pages/allow-access/allow-access.module.ts","./src/app/pages/allow-access/allow-access.page.ts","./src/app/pages/allow-access/allow-access.page.html"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAkB;AACoC;AAEtD,qBAAqB;AACoB;AACM;AACQ;AACE;AACE;AACA;AACE;AACkB;AACb;AACX;AACuB;AACZ;AACa;;;AAE/E,MAAM,MAAM,GAAW;IACtB;QACC,IAAI,EAAE,EAAE;QACR,SAAS,EAAE,kEAAe;KAC1B;CACD,CAAC;AAuBK,MAAM,iBAAiB;;gGAAjB,iBAAiB;4JAAjB,iBAAiB,kBApBpB;YACR,2DAAW;YACX,4DAAY;YACZ,oEAAa;YACb,sEAAc;YACd,wEAAe;YACf,wEAAe;YACf,0EAAgB;YAChB,4FAAgB;YAChB,6FAAgB;YAChB,+EAAkB;YAClB,mEAAmB;YACnB,4FAAwB;YACxB,6DAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;SAC7B;mIAMW,iBAAiB,mBAJ5B,kEAAe,aAff,2DAAW;QACX,4DAAY;QACZ,oEAAa;QACb,sEAAc;QACd,wEAAe;QACf,wEAAe;QACf,0EAAgB;QAChB,4FAAgB;QAChB,6FAAgB;QAChB,+EAAkB;QAClB,mEAAmB;QACnB,4FAAwB;6FAQb,iBAAiB;cArB7B,sDAAQ;eAAC;gBACT,OAAO,EAAE;oBACR,2DAAW;oBACX,4DAAY;oBACZ,oEAAa;oBACb,sEAAc;oBACd,wEAAe;oBACf,wEAAe;oBACf,0EAAgB;oBAChB,4FAAgB;oBAChB,6FAAgB;oBAChB,+EAAkB;oBAClB,mEAAmB;oBACnB,4FAAwB;oBACxB,6DAAY,CAAC,QAAQ,CAAC,MAAM,CAAC;iBAC7B;gBACD,YAAY,EAAE;oBACb,kEAAe;iBACf;aACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrC4D;AACO;;;;;;;;;;;;;;;;;;ICPhE,qEAEA;;;IAFK,6IAAgB;;;IAErB,qEACI;IAAA,uDACJ;IAAA,4DAAK;;;IADD,0DACJ;IADI,2FACJ;;;IAUQ,4EACI;IAAA,uDACJ;IAAA,4DAAY;;;IADR,0DACJ;IADI,+FACJ;;;IAUA,4EACI;IAAA,uDACJ;IAAA,4DAAY;;;IADR,0DACJ;IADI,kGACJ;;;IAUA,sFAAgG;;ADvBrG,MAAM,eAAe;IAE3B,YAAoB,KAAqB,EAAU,KAAmB,EAAU,MAAqB,EAAU,MAAc,EAAU,SAA2B,EAAU,OAAuB,EAAU,OAAoB,EAAU,YAAiC;QAAxP,UAAK,GAAL,KAAK,CAAgB;QAAU,UAAK,GAAL,KAAK,CAAc;QAAU,WAAM,GAAN,MAAM,CAAe;QAAU,WAAM,GAAN,MAAM,CAAQ;QAAU,cAAS,GAAT,SAAS,CAAkB;QAAU,YAAO,GAAP,OAAO,CAAgB;QAAU,YAAO,GAAP,OAAO,CAAa;QAAU,iBAAY,GAAZ,YAAY,CAAqB;QAErQ,SAAI,GAAc,IAAI,wDAAS,CAAC;YACtC,KAAK,EAAE,IAAI,0DAAW,CAAC,EAAE,EAAE,CAAC,yDAAU,CAAC,KAAK,EAAE,yDAAU,CAAC,QAAQ,CAAC,CAAC;YACnE,QAAQ,EAAE,IAAI,0DAAW,CAAC,EAAE,EAAE,CAAC,yDAAU,CAAC,QAAQ,CAAC,CAAC;SACpD,CAAC,CAAC;QACI,WAAM,GAAQ;YACpB,KAAK,EAAE,EAAE;YACT,QAAQ,EAAE,EAAE;SACZ,CAAC;QACK,QAAG,GAAQ,EAAE,CAAC;QAIb,kBAAa,GAAQ,EAAE,CAAC;IAdgP,CAAC;IAgBnQ,IAAI;;YACjB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YAEpB,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;gBACxC,MAAM,EAAE;oBACP,MAAM;oBACN,MAAM;oBACN,QAAQ;iBACR;gBACD,KAAK,EAAE,IAAI,CAAC,KAAK;aACjB,CAAC,CAAC;YAEH,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YAErB,IAAI,QAAQ,CAAC,EAAE,EAAE;gBAChB,IAAI,CAAC,GAAG,GAAG,QAAQ,CAAC,MAAM,CAAC;aAC3B;iBAAM;gBACN,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;aACtC;QACF,CAAC;KAAA;IAEY,MAAM;;YAClB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YAEpB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;YAEpB,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAEtD,MAAM,MAAM,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;YAE9E,MAAM,QAAQ,GAAG,MAAM,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;gBAC/C,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK;gBAC5B,MAAM;gBACN,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM;gBACvB,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ;gBAClC,WAAW,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,GAAG,UAAU;aACvC,CAAC,CAAC;YAEH,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YAEnB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;YAErB,IAAI,QAAQ,CAAC,EAAE,EAAE;gBAChB,MAAM,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,UAAU,EAAE,QAAQ,CAAC,MAAM,CAAC,MAAM,EAAE,WAAW,EAAE,QAAQ,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC;aAC/J;iBAAM;gBACN,IAAI,QAAQ,CAAC,KAAK,CAAC,IAAI,IAAI,GAAG,EAAE;oBAC/B,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;oBACxC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,iBAAiB,CAAC,EAAE;wBACzC,WAAW,EAAE;4BACZ,KAAK,EAAE,IAAI,CAAC,KAAK;4BACjB,MAAM,EAAE,IAAI,CAAC,MAAM;yBACnB;qBACD,CAAC;iBACF;qBAAM;oBACN,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;iBACxC;aACD;QACF,CAAC;KAAA;IAED,QAAQ;QACP,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACzB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC3B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC5B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAE5B,IAAI,CAAC,aAAa,CAAC,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE;YACjE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QACzE,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,aAAa,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,EAAE;YACjE,IAAI,MAAM,EAAE;gBACX,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC;gBAC/C,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;gBAC1B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;gBAC5B,IAAI,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,WAAW,IAAI,MAAM,CAAC,KAAK,KAAK,IAAI,EAAE;oBAClE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;iBAChD;gBACD,IAAI,CAAC,IAAI,EAAE,CAAC;aACZ;QACF,CAAC,CAAC,CAAC;IACJ,CAAC;IAED,WAAW;QACV,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;QACtC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;IACzC,CAAC;;8EAxGW,eAAe;+FAAf,eAAe;QChB5B,8EACI;QAAA,2GAEA;QAAA,yGACI;QAGJ,0EACI;QADqB,gLAAyC,YAAQ,IAAC;QACvE,oFACI;QAAA,4EACI;QAAA,kEACJ;QAAA,4DAAY;QAEZ,sEAEA;QAAA,uHACI;QAER,4DAAiB;QAEjB,oFACI;QAAA,6EACI;QAAA,sEACJ;QAAA,4DAAY;QAEZ,uEAEA;QAAA,yHACI;QAER,4DAAiB;QAEjB,wEACI;QAAA,8EACJ;QAAA,4DAAI;QAEJ,6EACI;QAAA,wDAEA;QAAA,+IAAyE;QAC7E,4DAAS;QAET,6EACI;QAAA,kEACJ;QAAA,4DAAS;QACb,4DAAO;QACX,4DAAc;;QA7CgD,0DAAgB;QAAhB,8EAAgB;QAEtE,0DAAgB;QAAhB,8EAAgB;QAId,0DAAkB;QAAlB,+EAAkB;QAQL,0DAAoB;QAApB,kFAAoB;QAYpB,0DAAuB;QAAvB,qFAAuB;QAUlC,0DAEA;QAFA,wGAEA;QAAyD,0DAAe;QAAf,6EAAe;;6FDvBvE,eAAe;cAN3B,uDAAS;eAAC;gBACV,QAAQ,EAAE,mBAAmB;gBAC7B,SAAS,EAAE,CAAC,0BAA0B,CAAC;gBACvC,WAAW,EAAE,0BAA0B;aACvC","file":"pages-allow-access-allow-access-module.js","sourcesContent":["/* --- PAES --- */\r\nimport { AllowAccessPage } from './allow-access.page';\r\n\r\n/* --- MODULES --- */\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { MatIconModule } from '@angular/material/icon';\r\nimport { MatInputModule } from '@angular/material/input';\r\nimport { MatSelectModule } from '@angular/material/select';\r\nimport { MatButtonModule } from '@angular/material/button';\r\nimport { MatToolbarModule } from '@angular/material/toolbar';\r\nimport { MatContentModule } from 'src/app/libs/mat-content/mat-content.module';\r\nimport { MatFormFieldModule } from '@angular/material/form-field';\r\nimport { Routes, RouterModule } from '@angular/router';\r\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { BackButtonModule } from 'src/app/libs/back-button/back-button.module';\r\n\r\nconst routes: Routes = [\r\n\t{\r\n\t\tpath: '',\r\n\t\tcomponent: AllowAccessPage\r\n\t}\r\n];\r\n\r\n@NgModule({\r\n\timports: [\r\n\t\tFormsModule,\r\n\t\tCommonModule,\r\n\t\tMatIconModule,\r\n\t\tMatInputModule,\r\n\t\tMatButtonModule,\r\n\t\tMatSelectModule,\r\n\t\tMatToolbarModule,\r\n\t\tMatContentModule,\r\n\t\tBackButtonModule,\r\n\t\tMatFormFieldModule,\r\n\t\tReactiveFormsModule,\r\n\t\tMatProgressSpinnerModule,\r\n\t\tRouterModule.forChild(routes)\r\n\t],\r\n\tdeclarations: [\r\n\t\tAllowAccessPage\r\n\t]\r\n})\r\n\r\nexport class AllowAccessModule { }\r\n","import { AppsService } from 'src/app/services/apps/apps.service';\r\nimport { ToastService } from 'src/app/services/toast/toast.service';\r\nimport { ConfigService } from 'src/app/services/config/config.service';\r\nimport { ButtonsService } from 'src/app/services/buttons/buttons.service';\r\nimport { FormErrorService } from 'src/app/services/form-error/form-error.service';\r\nimport { LocalstorageService } from 'src/app/services/localstorage/localstorage.service';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\nimport { OnInit, Component, OnDestroy } from '@angular/core';\r\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\r\n\r\n@Component({\r\n\tselector: 'allow-access-page',\r\n\tstyleUrls: ['./allow-access.page.scss'],\r\n\ttemplateUrl: './allow-access.page.html'\r\n})\r\n\r\nexport class AllowAccessPage implements OnInit, OnDestroy {\r\n\r\n\tconstructor(private route: ActivatedRoute, private toast: ToastService, private config: ConfigService, private router: Router, private formerror: FormErrorService, private buttons: ButtonsService, private service: AppsService, private localstorage: LocalstorageService) { }\r\n\r\n\tpublic form: FormGroup = new FormGroup({\r\n\t\temail: new FormControl('', [Validators.email, Validators.required]),\r\n\t\tpassword: new FormControl('', [Validators.required])\r\n\t});\r\n\tpublic errors: any = {\r\n\t\temail: '',\r\n\t\tpassword: ''\r\n\t};\r\n\tpublic app: any = {};\r\n\tpublic appId: string;\r\n\tpublic returl: string;\r\n\tpublic loading: boolean;\r\n\tprivate subscriptions: any = {};\r\n\r\n\tprivate async load() {\r\n\t\tthis.loading = true;\r\n\r\n\t\tconst response = await this.service.load({\r\n\t\t\tfilter: [\r\n\t\t\t\t'icon',\r\n\t\t\t\t'name',\r\n\t\t\t\t'scopes'\r\n\t\t\t],\r\n\t\t\tappId: this.appId\r\n\t\t});\r\n\r\n\t\tthis.loading = false;\r\n\r\n\t\tif (response.ok) {\r\n\t\t\tthis.app = response.result;\r\n\t\t} else {\r\n\t\t\tthis.toast.show('Issue loading app!');\r\n\t\t}\r\n\t}\r\n\r\n\tpublic async submit() {\r\n\t\tthis.loading = true;\r\n\r\n\t\tthis.form.disable();\r\n\r\n\t\tthis.localstorage.set('email', this.form.value.email);\r\n\r\n\t\tconst expiry = new Date(new Date().setFullYear(new Date().getFullYear() + 1));\r\n\r\n\t\tconst response = await this.service.allowaccess({\r\n\t\t\tappId: this.appId,\r\n\t\t\temail: this.form.value.email,\r\n\t\t\texpiry,\r\n\t\t\tscopes: this.app.scopes,\r\n\t\t\tpassword: this.form.value.password,\r\n\t\t\tdescription: this.app.name + ' (LOGIN)'\r\n\t\t});\r\n\r\n\t\tthis.form.enable();\r\n\r\n\t\tthis.loading = false;\r\n\r\n\t\tif (response.ok) {\r\n\t\t\twindow.open([this.returl, '?', 'email=', this.form.value.email, '&userId=', response.result.userId, '&tokenId=', response.result.tokenId].join(''), '_parent');\r\n\t\t} else {\r\n\t\t\tif (response.error.code == 403) {\r\n\t\t\t\tthis.toast.show(response.error.message);\r\n\t\t\t\tthis.router.navigate(['/request-access'], {\r\n\t\t\t\t\tqueryParams: {\r\n\t\t\t\t\t\tappId: this.appId,\r\n\t\t\t\t\t\treturl: this.returl\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t} else {\r\n\t\t\t\tthis.toast.show(response.error.message);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tngOnInit(): void {\r\n\t\tthis.buttons.hide('add');\r\n\t\tthis.buttons.hide('close');\r\n\t\tthis.buttons.hide('filter');\r\n\t\tthis.buttons.hide('search');\r\n\r\n\t\tthis.subscriptions.form = this.form.valueChanges.subscribe(data => {\r\n\t\t\tthis.errors = this.formerror.validateForm(this.form, this.errors, true);\r\n\t\t});\r\n\r\n\t\tthis.subscriptions.config = this.config.loaded.subscribe(loaded => {\r\n\t\t\tif (loaded) {\r\n\t\t\t\tconst params = this.route.snapshot.queryParams;\r\n\t\t\t\tthis.appId = params.appId;\r\n\t\t\t\tthis.returl = params.returl;\r\n\t\t\t\tif (typeof (params.email) != 'undefined' && params.email !== null) {\r\n\t\t\t\t\tthis.form.controls.email.setValue(params.email);\r\n\t\t\t\t}\r\n\t\t\t\tthis.load();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tngOnDestroy(): void {\r\n\t\tthis.subscriptions.form.unsubscribe();\r\n\t\tthis.subscriptions.config.unsubscribe();\r\n\t}\r\n\r\n}\r\n","<mat-content>\r\n    <img [src]=\"app.icon\" alt=\"icon\" width=\"100\" height=\"100\" *ngIf=\"app.icon\">\r\n\r\n    <h1 *ngIf=\"app.name\">\r\n        {{ app.name }}\r\n    </h1>\r\n\r\n    <form [formGroup]=\"form\" (ngSubmit)=\"!form.invalid && !loading && submit()\">\r\n        <mat-form-field appearance=\"outline\">\r\n            <mat-label>\r\n                Email\r\n            </mat-label>\r\n            \r\n            <input matInput type=\"email\" name=\"email\" placeholder=\"email\" formControlName=\"email\" required>\r\n\r\n            <mat-error *ngIf=\"errors.email\">\r\n                {{ errors.email }}\r\n            </mat-error>\r\n        </mat-form-field>\r\n\r\n        <mat-form-field appearance=\"outline\">\r\n            <mat-label>\r\n                Password\r\n            </mat-label>\r\n            \r\n            <input matInput type=\"password\" name=\"password\" placeholder=\"password\" formControlName=\"password\" required>\r\n\r\n            <mat-error *ngIf=\"errors.password\">\r\n                {{ errors.password }}\r\n            </mat-error>\r\n        </mat-form-field>\r\n        \r\n        <a class=\"forgot-password\" routerLink=\"/forgot-password\" queryParamsHandling=\"preserve\">\r\n            Forgot Password?\r\n        </a>\r\n\r\n        <button type=\"submit\" mat-flat-button color=\"primary\">\r\n            {{ loading ? '' : 'sign in' }}\r\n\r\n            <mat-progress-spinner mode=\"indeterminate\" diameter=\"30\" *ngIf=\"loading\"></mat-progress-spinner>\r\n        </button>\r\n\r\n        <button type=\"button\" mat-stroked-button color=\"primary\" back-button>\r\n            back\r\n        </button>\r\n    </form>\r\n</mat-content>"],"sourceRoot":"webpack:///"}