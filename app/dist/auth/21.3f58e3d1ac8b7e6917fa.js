(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"4gMo":function(t,e,i){"use strict";i.r(e),i.d(e,"FeaturesModule",(function(){return It}));var o=i("mrSG"),s=i("Ovx2");class a{constructor(t){this.app={name:null,icon:null},this.role=0,null!=t&&(null!=t.app&&(null!=t.app.name&&(this.app.name=t.app.name),null!=t.app.icon&&(this.app.icon=t.app.icon)),null!=t.role&&(this.role=t.role),null!=t.appId&&(this.appId=t.appId),null!=t.title&&(this.title=t.title),null!=t.featureId&&(this.featureId=t.featureId),null!=t.description&&(this.description=t.description))}}var r=i("Dh3D"),n=i("+0xr"),c=i("3Pt+"),l=i("0IaG"),d=i("fXoL"),b=i("xyCQ"),p=i("dWDE"),u=i("/t3+"),f=i("kmnG"),m=i("bTqV"),h=i("NFeN"),g=i("4jEk"),v=i("ofXK"),I=i("d3UM"),w=i("FKr1"),S=i("WJ5W"),R=i("bv9b"),y=i("AbOq"),k=i("roMP");function O(t,e){1&t&&d.Nb(0,"mat-progress-bar",11)}function M(t,e){if(1&t&&(d.Sb(0,"mat-option",12),d.Bc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.appId),d.Ab(1),d.Dc(" ",t.name," ")}}function C(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Bc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Dc(" ",t.errors.appId," ")}}const A=function(t){return{name:t}};let D=(()=>{class t{constructor(t,e,i,o){this.apps=t,this.dialog=e,this.config=i,this.formerror=o,this.form=new c.f({appId:new c.c([])}),this.errors={appId:""},this.filter=new c.f({app:new c.c("")}),this.subscriptions={}}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["name","appId"]});this.apps.data=t.ok?t.result.map(t=>new s.a(t)):[],void 0!==this.config.appId&&null!=this.config.appId&&this.form.controls.appId.setValue(this.config.appId),this.loading=!1}))}close(){return Object(o.a)(this,void 0,void 0,(function*(){this.dialog.close(!1)}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.dialog.close(this.form.value)}))}ngOnInit(){this.subscriptions.form=this.form.valueChanges.subscribe(t=>{this.errors=this.formerror.validateForm(this.form,this.errors,!0)}),this.load()}ngOnDestroy(){this.subscriptions.form.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(b.a),d.Mb(l.d),d.Mb(l.a),d.Mb(p.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["features-filter-dialog"]],decls:21,vars:13,consts:[[1,"spacer"],["mat-icon-button","",3,"click"],["mode","indeterminate",4,"ngIf"],[3,"formGroup","ngSubmit"],["appearance","outline"],["name","appId","formControlName","appId","multiple",""],[3,"formGroup"],["placeholderLabel","filter apps","noEntriesFoundLabel","no apps found","formControlName","app"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["type","submit","color","primary","mat-flat-button",""],["mode","indeterminate"],[3,"value"]],template:function(t,e){1&t&&(d.Sb(0,"mat-toolbar"),d.Sb(1,"mat-label",0),d.Bc(2," Filter Features "),d.Rb(),d.Sb(3,"button",1),d.ac("click",(function(){return e.close()})),d.Sb(4,"mat-icon"),d.Bc(5," close "),d.Rb(),d.Rb(),d.Rb(),d.Sb(6,"mat-content"),d.zc(7,O,1,0,"mat-progress-bar",2),d.Sb(8,"form",3),d.ac("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),d.Sb(9,"mat-form-field",4),d.Sb(10,"mat-label"),d.Bc(11," App(s) "),d.Rb(),d.Sb(12,"mat-select",5),d.Sb(13,"mat-option",6),d.Nb(14,"ngx-mat-select-search",7),d.Rb(),d.zc(15,M,2,2,"mat-option",8),d.fc(16,"filterBy"),d.fc(17,"orderBy"),d.Rb(),d.zc(18,C,2,1,"mat-error",9),d.Rb(),d.Sb(19,"button",10),d.Bc(20," submit "),d.Rb(),d.Rb(),d.Rb()),2&t&&(d.Ab(7),d.kc("ngIf",e.loading),d.Ab(1),d.kc("formGroup",e.form),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(16,5,d.hc(17,8,e.apps.data,"name"),d.mc(11,A,e.filter.value.app))),d.Ab(3),d.kc("ngIf",e.errors.appId))},directives:[u.a,f.g,m.b,h.a,g.a,v.l,c.x,c.p,c.g,f.c,I.a,c.o,c.e,w.k,S.a,v.k,R.a,f.b],pipes:[y.a,k.a],styles:[".filter-dialog{width:500px!important}.filter-dialog .mat-dialog-container{padding:0!important}@media screen and (max-width:600px){.filter-dialog .mat-dialog-container{top:0;left:0;right:0;bottom:0;z-index:5000;position:fixed;border-radius:0}}"],encapsulation:2}),t})();var x=i("9ZKQ"),B=i("u0tM"),P=i("L7HW"),z=i("bS1C"),j=i("tyNb"),F=i("swrf"),N=i("BhS5"),_=i("wJso"),q=i("znSr"),G=i("MutI"),H=i("A5z7");function $(t,e){1&t&&d.Nb(0,"mat-progress-bar",14)}function J(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-chip",17),d.ac("removed",(function(){d.rc(t);const i=e.$implicit;return d.ec(2).unfilter("appId",i)})),d.Sb(1,"mat-icon"),d.Bc(2," apps "),d.Rb(),d.Sb(3,"mat-label"),d.Bc(4),d.Rb(),d.Sb(5,"mat-icon",18),d.Bc(6," cancel "),d.Rb(),d.Rb()}if(2&t){const t=e.$implicit,i=d.ec(2);d.Ab(4),d.Dc(" ",i.describe(i.apps.data,"appId",t)," ")}}function Q(t,e){if(1&t&&(d.Sb(0,"mat-chip-list",15),d.zc(1,J,7,1,"mat-chip",16),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.kc("ngForOf",t.filter.appId)}}function T(t,e){1&t&&(d.Sb(0,"th",19),d.Bc(1," App "),d.Rb())}function L(t,e){if(1&t&&(d.Sb(0,"td",20),d.Bc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Dc(" ",t.app.name," ")}}function V(t,e){1&t&&(d.Sb(0,"th",19),d.Bc(1," Title "),d.Rb())}function E(t,e){if(1&t&&(d.Sb(0,"td",20),d.Bc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Dc(" ",t.title," ")}}function Z(t,e){1&t&&(d.Sb(0,"th",19),d.Bc(1," Description "),d.Rb())}function K(t,e){if(1&t&&(d.Sb(0,"td",20),d.Bc(1),d.Rb()),2&t){const t=e.$implicit;d.Ab(1),d.Dc(" ",t.description," ")}}function W(t,e){1&t&&d.Nb(0,"th",21)}function U(t,e){if(1&t){const t=d.Tb();d.Sb(0,"td",20),d.Sb(1,"button",22),d.ac("click",(function(){d.rc(t);const i=e.$implicit;return d.ec().options(i)})),d.Sb(2,"mat-icon"),d.Bc(3," more_vert "),d.Rb(),d.Rb(),d.Rb()}}function X(t,e){1&t&&d.Nb(0,"tr",23)}function Y(t,e){1&t&&d.Nb(0,"tr",24)}function tt(t,e){if(1&t){const t=d.Tb();d.Sb(0,"mat-list-item",25),d.ac("click",(function(){d.rc(t);const i=e.$implicit;return d.ec().options(i)})),d.Sb(1,"mat-label"),d.Sb(2,"h3"),d.Bc(3),d.Rb(),d.Sb(4,"p"),d.Bc(5),d.Rb(),d.Rb(),d.Rb()}if(2&t){const t=e.$implicit;d.Ab(3),d.Dc(" ",t.title," "),d.Ab(2),d.Dc(" ",t.description," ")}}let et=(()=>{class t{constructor(t,e,i,o,s,a,r,c,l,d){this.apps=t,this.toast=e,this.dialog=i,this.sheet=o,this.config=s,this.filters=a,this.router=r,this.confirm=c,this.buttons=l,this.service=d,this.filter=this.filters.get({appId:[]}),this.columns=["app.name","title","description","options"],this.features=new n.k,this.subscriptions={}}list(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.list({filter:["app","icon","role","title","appId","featureId","description"],appId:this.filter.appId});this.features.data=t.ok?t.result.map(t=>new a(t)):[],this.loading=!1}))}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["name","appId"]});this.apps.data=t.ok?t.result.map(t=>new s.a(t)):[],this.loading=!1}))}unfilter(t,e){this.filter[t]=this.filter[t].filter(t=>t!=e),this.filters.update(this.filter),this.list()}options(t){return Object(o.a)(this,void 0,void 0,(function*(){this.sheet.show({role:t.role,title:t.title,options:[{icon:"edit",title:"Edit",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.router.navigate(["/features","editor"],{queryParams:{mode:"update",featureId:t.featureId}})})),disabled:[0,1]},{icon:"content_copy",title:"Copy",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.router.navigate(["/features","editor"],{queryParams:{mode:"copy",featureId:t.featureId}})})),disabled:[0,1]},{icon:"delete",title:"Delete",danger:!0,handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.confirm.show({message:"Are you sure you want to delete "+t.title+"?",handler:()=>Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const e=yield this.service.delete({featureId:t.featureId});if(e.ok){for(let e=0;e<this.features.data.length;e++)if(this.features.data[e].featureId==t.featureId){this.features.data.splice(e,1),this.toast.show("Feature was removed!");break}this.features.data=JSON.parse(JSON.stringify(this.features.data))}else this.toast.show(e.error.message);this.loading=!1}))})})),disabled:[0,1,2,3,4]}]})}))}describe(t,e,i){let o="-";return t.map(t=>{t[e]==i&&(o=t.name)}),o}ngOnInit(){this.buttons.show("add"),this.buttons.hide("close"),this.buttons.show("filter"),this.buttons.show("search"),this.features.sort=this.sort,this.features.sort.active="title",this.features.sort.direction="asc",this.subscriptions.add=this.buttons.add.click.subscribe(t=>{this.router.navigate(["/features","editor"],{queryParams:{mode:"add"}})}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){t&&(yield this.list(),yield this.load())}))),this.subscriptions.search=this.buttons.search.value.subscribe(t=>{this.features.filter=t}),this.subscriptions.filter=this.buttons.filter.click.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){const t=yield this.dialog.open(D,{data:this.filter,panelClass:"filter-dialog"});yield t.afterClosed().subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){t&&(Object.keys(t).map(e=>{this.filter[e]=t[e]}),this.filters.update(this.filter),this.list())})))})))}ngOnDestroy(){this.buttons.reset("search"),this.subscriptions.add.unsubscribe(),this.subscriptions.loaded.unsubscribe(),this.subscriptions.filter.unsubscribe(),this.subscriptions.search.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(b.a),d.Mb(x.a),d.Mb(l.b),d.Mb(B.a),d.Mb(P.a),d.Mb(z.a),d.Mb(j.c),d.Mb(F.a),d.Mb(N.a),d.Mb(_.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["features-page"]],viewQuery:function(t,e){var i;1&t&&d.vc(r.a,!0),2&t&&d.oc(i=d.bc())&&(e.sort=i.first)},decls:19,vars:7,consts:[["mode","indeterminate",4,"ngIf"],["class","filterbar",4,"ngIf"],["mat-table","","fxShow","","fxHide.xs","true","matSort","",3,"dataSource"],["matColumnDef","app.name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","title"],["matColumnDef","description"],["matColumnDef","options"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["fxHide","","fxShow.xs","true"],["lines","full","matRipple","",3,"click",4,"ngFor","ngForOf"],["mode","indeterminate"],[1,"filterbar"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","",3,"click"],["mat-header-row",""],["mat-row",""],["lines","full","matRipple","",3,"click"]],template:function(t,e){1&t&&(d.zc(0,$,1,0,"mat-progress-bar",0),d.zc(1,Q,2,1,"mat-chip-list",1),d.Sb(2,"table",2),d.Qb(3,3),d.zc(4,T,2,0,"th",4),d.zc(5,L,2,1,"td",5),d.Pb(),d.Qb(6,6),d.zc(7,V,2,0,"th",4),d.zc(8,E,2,1,"td",5),d.Pb(),d.Qb(9,7),d.zc(10,Z,2,0,"th",4),d.zc(11,K,2,1,"td",5),d.Pb(),d.Qb(12,8),d.zc(13,W,1,0,"th",9),d.zc(14,U,4,0,"td",5),d.Pb(),d.zc(15,X,1,0,"tr",10),d.zc(16,Y,1,0,"tr",11),d.Rb(),d.Sb(17,"mat-list",12),d.zc(18,tt,6,2,"mat-list-item",13),d.Rb()),2&t&&(d.kc("ngIf",e.loading),d.Ab(1),d.kc("ngIf",e.filter.appId.length>0),d.Ab(1),d.kc("dataSource",e.features),d.Ab(13),d.kc("matHeaderRowDef",e.columns)("matHeaderRowDefSticky",!0),d.Ab(1),d.kc("matRowDefColumns",e.columns),d.Ab(2),d.kc("ngForOf",e.features.data))},directives:[v.l,n.j,q.a,r.a,n.c,n.e,n.b,n.g,n.i,G.a,v.k,R.a,H.c,H.a,h.a,f.g,H.d,n.d,r.b,n.a,m.b,n.f,n.h,G.b,w.p],styles:[".mat-column-title[_ngcontent-%COMP%]{width:30%}.mat-column-options[_ngcontent-%COMP%]{width:40px;padding-right:16px!important}mat-list[_ngcontent-%COMP%]   mat-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row}"]}),t})();var it=i("qFsG"),ot=i("ZRfb");function st(t,e){if(1&t&&(d.Sb(0,"mat-option",10),d.Bc(1),d.Rb()),2&t){const t=e.$implicit;d.kc("value",t.appId),d.Ab(1),d.Dc(" ",t.name," ")}}function at(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Bc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Dc(" ",t.errors.appId," ")}}function rt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Bc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Dc(" ",t.errors.title," ")}}function nt(t,e){if(1&t&&(d.Sb(0,"mat-error"),d.Bc(1),d.Rb()),2&t){const t=d.ec();d.Ab(1),d.Dc(" ",t.errors.description," ")}}const ct=function(t){return{name:t}};let lt=(()=>{class t{constructor(t,e,i,o,s,a,r){this.apps=t,this.toast=e,this.route=i,this.config=o,this.router=s,this.buttons=a,this.service=r,this.form=new c.f({appId:new c.c(null,[c.w.required]),title:new c.c(null,[c.w.required]),description:new c.c(null,[c.w.required])}),this.errors={appId:"",title:"",description:""},this.filter=new c.f({apps:new c.c("",[c.w.required])}),this.subscriptions={}}get(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.service.get({filter:["role","appId","title","description"],featureId:this.featureId});if(t.ok){const e=new a(t.result);e.role>=2?(this.form.controls.appId.setValue(e.appId),this.form.controls.title.setValue(e.title),this.form.controls.description.setValue(e.description)):(this.toast.show("You have insufficient rights to edit this feature!"),this.router.navigate(["/features"]))}else this.toast.show(t.error.message),this.router.navigate(["/features"]);this.loading=!1}))}load(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=yield this.apps.list({filter:["role","name","icon","appId"]});t.ok?this.apps.data=t.result.map(t=>new s.a(t)).filter(t=>t.role>=2):(this.apps.data=[],this.toast.show(t.error.message)),this.loading=!1}))}submit(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0;let t=this.mode;"copy"==t&&(t="add",delete this.featureId);const e=yield this.service[t]({appId:this.form.value.appId,title:this.form.value.title,featureId:this.featureId,description:this.form.value.description});e.ok?this.router.navigate(["/features"]):this.toast.show(e.error.message),this.loading=!1}))}ngOnInit(){this.buttons.hide("add"),this.buttons.show("close"),this.buttons.hide("filter"),this.buttons.hide("search"),this.subscriptions.close=this.buttons.close.click.subscribe(t=>{this.router.navigate(["/features"])}),this.subscriptions.loaded=this.config.loaded.subscribe(t=>Object(o.a)(this,void 0,void 0,(function*(){if(t){const t=this.route.snapshot.queryParams;this.mode=t.mode,this.featureId=t.featureId,"add"!=this.mode?(yield this.get(),yield this.load(),this.form.controls.appId.disable()):(yield this.load(),this.form.controls.appId.enable())}})))}ngOnDestroy(){this.subscriptions.close.unsubscribe(),this.subscriptions.loaded.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Mb(b.a),d.Mb(x.a),d.Mb(j.a),d.Mb(P.a),d.Mb(j.c),d.Mb(N.a),d.Mb(_.a))},t.\u0275cmp=d.Gb({type:t,selectors:[["features-editor-page"]],decls:24,vars:13,consts:[[3,"formGroup","ngSubmit"],["appearance","outline"],["name","appId","placeholder","appId","formControlName","appId","required",""],[3,"formGroup"],["placeholderLabel","filter apps","noEntriesFoundLabel","no apps found","formControlName","apps"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","type","text","name","title","placeholder","title","formControlName","title","required",""],["matInput","","type","text","name","description","placeholder","description","formControlName","description","required",""],["type","button","mat-flat-button","","color","primary",3,"disabled","click"],[3,"value"]],template:function(t,e){1&t&&(d.Sb(0,"mat-content"),d.Sb(1,"form",0),d.ac("ngSubmit",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),d.Sb(2,"mat-form-field",1),d.Sb(3,"mat-label"),d.Bc(4," App "),d.Rb(),d.Sb(5,"mat-select",2),d.Sb(6,"mat-option",3),d.Nb(7,"ngx-mat-select-search",4),d.Rb(),d.zc(8,st,2,2,"mat-option",5),d.fc(9,"filterBy"),d.Rb(),d.zc(10,at,2,1,"mat-error",6),d.Rb(),d.Sb(11,"mat-form-field",1),d.Sb(12,"mat-label"),d.Bc(13," Title "),d.Rb(),d.Nb(14,"input",7),d.zc(15,rt,2,1,"mat-error",6),d.Rb(),d.Sb(16,"mat-form-field",1),d.Sb(17,"mat-label"),d.Bc(18," Description "),d.Rb(),d.Nb(19,"input",8),d.zc(20,nt,2,1,"mat-error",6),d.Rb(),d.Rb(),d.Rb(),d.Sb(21,"mat-footer"),d.Sb(22,"button",9),d.ac("click",(function(){return!e.loading&&!e.form.invalid&&e.submit()})),d.Bc(23),d.Rb(),d.Rb()),2&t&&(d.Ab(1),d.kc("formGroup",e.form),d.Ab(5),d.kc("formGroup",e.filter),d.Ab(2),d.kc("ngForOf",d.hc(9,8,e.apps.data,d.mc(11,ct,e.filter.value.apps))),d.Ab(2),d.kc("ngIf",e.errors.appId),d.Ab(5),d.kc("ngIf",e.errors.title),d.Ab(5),d.kc("ngIf",e.errors.description),d.Ab(2),d.kc("disabled",e.form.invalid),d.Ab(1),d.Dc(" ",e.mode," "))},directives:[g.a,c.x,c.p,c.g,f.c,f.g,I.a,c.o,c.e,c.v,w.k,S.a,v.k,v.l,it.a,c.b,ot.a,m.b,f.b],pipes:[y.a],styles:["[upload][_ngcontent-%COMP%]{width:100px;margin:auto;height:100px;border:2px solid transparent;display:flex;align-items:center;border-radius:100%;justify-content:center;background-color:#eee}[upload].required[_ngcontent-%COMP%]{border-color:red}mat-content[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:column}mat-content[_ngcontent-%COMP%]   form[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{max-width:400px;margin-top:20px}mat-content[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], mat-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;max-width:400px}mat-footer[_ngcontent-%COMP%]{justify-content:center}"]}),t})();var dt=i("wZkO"),bt=i("gyTc"),pt=i("R32p"),ut=i("tVzd"),ft=i("J89Z"),mt=i("YUcS"),ht=i("H0Zp"),gt=i("p/0r");const vt=[{path:"",component:et},{path:"editor",component:lt}];let It=(()=>{class t{}return t.\u0275mod=d.Kb({type:t}),t.\u0275inj=d.Jb({factory:function(e){return new(e||t)},imports:[[c.i,v.c,pt.a,dt.a,h.b,r.c,G.c,bt.a,H.e,n.l,it.b,l.c,ft.a,ut.a,w.q,m.c,I.b,mt.a,ht.a,gt.a,u.b,f.e,c.u,R.b,S.b,j.g.forChild(vt)]]}),t})()}}]);